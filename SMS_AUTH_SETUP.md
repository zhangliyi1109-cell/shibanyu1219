# 手机短信验证设置指南

## ✅ 已实现的功能

1. **手机号登录/注册**
   - 输入手机号发送验证码
   - 输入6位验证码完成登录/注册
   - 自动识别新用户（注册）和已有用户（登录）

2. **验证码管理**
   - 60秒倒计时防止频繁发送
   - 重新发送验证码功能
   - 验证码输入框（6位数字）

3. **用户体验优化**
   - 手机号格式化（自动移除非数字）
   - 手机号验证（11位中国手机号）
   - 手机号脱敏显示
   - 友好的错误提示

## 🔧 Supabase 配置

### 1. 启用手机号认证

在 Supabase 控制台中：

1. 进入 **Authentication** → **Providers**
2. 找到 **Phone** 提供商
3. **启用** Phone 认证
4. 配置以下设置：
   - **Enable phone confirmations**: 开启（必须）
   - **Phone number format**: 选择你的国家/地区

### 2. 配置短信服务

Supabase 支持多种短信服务提供商：

#### 选项 1：使用 Supabase 默认服务（开发/测试）

- Supabase 提供免费的测试短信服务
- 适合开发和测试环境
- 有发送限制

#### 选项 2：配置 Twilio（推荐生产环境）

1. 注册 [Twilio](https://www.twilio.com/) 账号
2. 获取 Account SID 和 Auth Token
3. 在 Supabase 中配置：
   - 进入 **Settings** → **Auth** → **SMS**
   - 选择 **Twilio**
   - 填入 Twilio 凭证

#### 选项 3：配置其他服务商

Supabase 还支持：
- MessageBird
- Vonage (Nexmo)
- Textlocal
- 自定义 Webhook

### 3. 配置重定向URL

1. 进入 **Authentication** → **URL Configuration**
2. 添加重定向URL：
   - Site URL: `http://localhost:3000` (开发环境)
   - Redirect URLs: 
     - `http://localhost:3000/**`
     - `https://your-domain.com/**` (生产环境)

## 📝 使用说明

### 用户登录/注册流程

1. **输入手机号**
   - 在登录界面输入11位手机号
   - 点击"发送验证码"

2. **接收验证码**
   - 查看手机短信
   - 收到6位数字验证码

3. **输入验证码**
   - 在验证码输入框输入6位数字
   - 点击"登录"按钮

4. **完成登录**
   - 验证成功后自动登录
   - 首次使用会自动注册

### 重新发送验证码

如果没收到验证码或验证码过期：

1. 等待60秒倒计时结束
2. 点击"重新发送"按钮
3. 检查手机短信

## 🔒 安全说明

### 手机号格式

- 当前实现支持中国手机号（11位，以1开头）
- 格式：`1[3-9]XXXXXXXXX`
- 自动添加国家代码 `+86`

### 验证码安全

- 验证码有效期：通常为5-10分钟（由 Supabase 配置）
- 验证码只能使用一次
- 有发送频率限制（防止滥用）

## ⚙️ 自定义配置

### 修改手机号格式

如果需要支持其他国家/地区的手机号：

1. 修改 `components/Login.tsx` 中的 `validatePhone` 函数
2. 修改 `formatPhone` 函数中的国家代码
3. 更新 `services/authService.ts` 中的国家代码前缀

### 修改倒计时时间

在 `components/Login.tsx` 中修改：
```typescript
setCountdown(60); // 改为你想要的秒数
```

## 🐛 故障排除

### 问题：收不到验证码

**可能原因：**
1. 短信服务未配置
2. 手机号格式错误
3. 发送频率限制
4. 短信被拦截

**解决方案：**
1. 检查 Supabase 短信配置
2. 确认手机号格式正确
3. 等待一段时间后重试
4. 检查手机短信拦截设置

### 问题：验证码错误

**可能原因：**
1. 验证码已过期
2. 验证码输入错误
3. 验证码已被使用

**解决方案：**
1. 重新发送验证码
2. 仔细检查输入
3. 使用新的验证码

### 问题：手机号格式错误

**解决方案：**
- 确保输入11位数字
- 不要包含空格、横线等
- 以1开头，第二位为3-9

## 💰 费用说明

### Supabase 免费额度

- 每月免费短信数量有限
- 超出后需要付费或配置自己的短信服务

### Twilio 费用

- 按短信条数计费
- 不同国家/地区价格不同
- 中国短信约 $0.01-0.05/条

## 📚 相关文件

- `services/authService.ts` - 认证服务（已更新为手机号）
- `components/Login.tsx` - 登录组件（已更新为手机号）
- `App.tsx` - 主应用（已更新显示手机号）

## 🎉 完成

现在你的应用已经支持：
- ✅ 手机号登录/注册
- ✅ 短信验证码
- ✅ 自动注册新用户
- ✅ 友好的用户体验

用户可以使用手机号快速登录，无需记住密码！

